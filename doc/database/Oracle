oracle体系结构
oracle数据库的结构
1.逻辑数据库结构
表空间(table space)
oralce数据库在逻辑上划分为一个或多个表空间,
默认表空间:
system
sysaux
undo
temporary
默认参数表空间

现在不需要使用大量的表空间
使用表空间的原因:
1.表空间更容易将空间限额分配给不同的用户
2.可以把表空间作为执行备份和恢复的任务
3.由于数据仓库分区表可以分布在几个表空间上,因此可以使表空间横跨几个磁盘和控制器,提高性能
4.可以使一个表空间脱机而不需要影响整个数据库
5.表空间是分配数据库空间的更简单的方式
6.使用表空间级别的导出和导入

数据库和实例
数据库指oracle数据库文件和系统文件
实例指数据进程

段(segment) 一个段分配给一个逻辑结构,如一个表,一个索引或其他对象
一组区组成段,oracle称分配给任一数据库对象的所有空间为一个段
区(extent)
相邻数据块组合在一起,成为一个区.
当创建诸如表和索引之类的数据对象时,要分配给他一个初始的空间量,称为初始区,还要为对象指定下一个区的空间量.
块(data block)
最小逻辑分区;操作系统磁盘块尺寸的整数倍
数据块的内部结构:行数据部分和可用空间部分

2.物理数据库结构
数据文件
控制文件
控制文件包含数据文件和重做日志文件的名字和位置,当前日志序号,备份集详细信息,以及所有scn.

重做日志文件
纪录了对数据库所做的全部修改
当前用来纪录数据库更改的重做日志文件组称为联机重做日志文件
归档重做日志文件

spfile
密码文件
预警日志文件
跟踪文件
备份文件

3.oracle进程
后台进程:
数据库写入器 DBWn 将更改的数据从缓冲区写入到磁盘
日志写入器 LGWR 将重做日志缓冲区内容写入联机重做日志文件
检查点 CKPT 更新所有数据文件的头以纪录检查点的详细信息
进程监控器PMON 清除完成后的进程和失败的进程
系统监控器 SMON 执行崩溃恢复并合并区
归档器 ARCn 归档填满的联机重做日志文件

4.oracle内存结构
SGA
目的是提高查询性能,允许大量的并发数据库活动.
数据库缓冲区高速缓存
共享池
重做日志缓冲区
java池
大池
流池

PGA

5.事务
提交事务:
    1.生成撤销信息,这些信息基本上由要更改的数据的更改前的值组成,撤销数据存储在撤销段中,撤销段位于撤销表空间中.
    2.在重做日志缓冲区中生成包含对数据快和回滚块更改的重做日志数据,数据库可以在提交事务前写重做日志缓冲区内容到磁盘.
    3.更改SGA中的数据缓冲区,可以在提交事务前把SGA中的事务更改写入到数据文件中.
    在数据库提交一个事务:
    1.数据库对提交的事务分配和纪录一个SCN
    2.日志写入器从SGA的重做日志缓冲区写重做日志项到磁盘上的重做日志;崇左日志写入器在重做日志文件中纪录此事务的SCN.标记事务正式
    提交.
    3.数据库释放所有行锁和表锁
    4.数据库标记事务完成
回滚事务:
    执行rollback命令,可以撤销至今尚未完成的事务所做的更改.重做日志包含事务所做的所有更改,撤销段包含更改之前存在的所有旧值,可以回滚
    整个事务所做的.

数据一致性和数据并发性
    oracle使用撤销段确保数据的一致性.
    oracle使用锁定机制确保数据的一致性.两种方式:独占锁定方式和共享锁定方式.

6.表
临时表
    1.减少了由事务引起的重做活动量
    2.可以索引临时表提高性能
    3.在临时表中,会话可以像普通永久表中那样更新,插入和删除数据
    4.在一个事务或会话后临时表会自动从临时表空间中删除
    5.可在临时表上定义表的约束
    6.不同的用户可以访问相同的临时表,每个用户只能看到自己的会话数据
    7.临时表提供了高效的数据访问,因为不需要重复执行复杂的查询
    8.临时表的锁定量很小,这意味着更高效的查询处理
    9.临时表的结构在数据删除后仍然存在
索引组织表 IOT
以B树索引形式存储数据的表.IOT包含了键和非键列,oracle使用B树索引结构存储经主键排序过的数据.
在更新IOT时,实际上更新的是索引结构.

分区表
分区表的join排序问题

oracle索引
创建索引的准则:
    1.要访问的数据占数据总量比较小时,使用索引,当占比高时使用全表扫描,使用索引查询会有两次IO,即索引和表数据
    2.相对较小的表不需要使用索引
    3.为所有表创建主键
    4.对包括在多表连接中的列建立索引
    5.对where子句中频繁使用的列加索引
    6.对order by group by,distinct字段添加索引
    7.由长字符串组成的列通常不加索引
    8.被频繁更改的列由于涉及开销问题,理论不索引
    9.只对高选择性列添加索引
    10.使索引数目较少.

索引类型:
    1.B树索引
    2.位图索引
    3.反向键索引
    4.键压缩索引
    5.基于函数的索引
    6.分区索引
    7.不可见索引

视图

oracle事务
原子性,一致性,隔离性,持久性
脏读,幻读,更新丢失,不可重复读

隔离级别和ISO事务标准
未提交读
提交读
可重复读
串行读

oracle锁定方法
oracle锁类型:
    1.dml锁
    2.ddl锁
    3.闩
    4.内部锁
    5.分布锁

利用撤销数据



